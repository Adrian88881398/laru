<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos DelFrio - Cat√°logo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Michroma&family=MuseoModerno:wght@400;700&family=Rubik:wght@400;500;700&display=swap"
        rel="stylesheet">

    <style>
        body {
            font-family: 'Rubik', sans-serif;
            background-color: #f8fafc;
        }

        .font-title {
            font-family: 'Michroma', sans-serif;
        }

        .font-slogan {
            font-family: 'MuseoModerno', sans-serif;
        }

        /* --- Acorde√≥n --- */
        .accordion-header {
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .accordion-header:hover {
            background-color: #f4f4f5;
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, padding 0.5s ease-out;
            padding: 0 1.5rem;
        }

        /* --- CORRECCI√ìN JARCER√çA --- */
        /* Aumentado a 10000px para que quepa la lista larga */
        .accordion-content.open {
            max-height: 10000px;
            padding: 1.5rem 1.5rem;
        }

        /* --- Correcci√≥n de Flecha --- */
        .accordion-arrow {
            transition: transform 0.3s ease;
            transform: rotate(-180deg);
        }

        .accordion-header.open .accordion-arrow {
            transform: rotate(0deg);
        }

        /* --- Estilos para las 30 Burbujas --- */
        .bubble {
            position: absolute;
            bottom: -100px;
            background: rgba(67, 56, 202, 0.3);
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1), 0 0 5px rgba(255, 255, 255, 0.4) inset;
            animation: animate-bubble 25s linear infinite;
            opacity: 0;
            pointer-events: none;
        }

        @keyframes animate-bubble {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 0.1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                transform: translateY(-120vh) scale(1.2);
                opacity: 0;
            }
        }

        /* Variaciones de las burbujas */
        .bubble:nth-child(1) {
            left: 10%;
            animation-duration: 20s;
            animation-delay: 0s;
            width: 30px;
            height: 30px;
        }

        .bubble:nth-child(2) {
            left: 20%;
            animation-duration: 15s;
            animation-delay: 2s;
            width: 25px;
            height: 25px;
        }

        .bubble:nth-child(3) {
            left: 35%;
            animation-duration: 22s;
            animation-delay: 5s;
            width: 40px;
            height: 40px;
        }

        .bubble:nth-child(4) {
            left: 50%;
            animation-duration: 18s;
            animation-delay: 1s;
            width: 20px;
            height: 20px;
        }

        .bubble:nth-child(5) {
            left: 65%;
            animation-duration: 25s;
            animation-delay: 3s;
            width: 35px;
            height: 35px;
        }

        .bubble:nth-child(6) {
            left: 80%;
            animation-duration: 17s;
            animation-delay: 6s;
            width: 28px;
            height: 28px;
        }

        .bubble:nth-child(7) {
            left: 90%;
            animation-duration: 23s;
            animation-delay: 4s;
            width: 22px;
            height: 22px;
        }

        .bubble:nth-child(8) {
            left: 5%;
            animation-duration: 19s;
            animation-delay: 8s;
            width: 32px;
            height: 32px;
        }

        .bubble:nth-child(9) {
            left: 25%;
            animation-duration: 21s;
            animation-delay: 7s;
            width: 38px;
            height: 38px;
        }

        .bubble:nth-child(10) {
            left: 45%;
            animation-duration: 24s;
            animation-delay: 9s;
            width: 26px;
            height: 26px;
        }

        .bubble:nth-child(11) {
            left: 15%;
            animation-duration: 20s;
            animation-delay: 1s;
            width: 30px;
            height: 30px;
        }

        .bubble:nth-child(12) {
            left: 28%;
            animation-duration: 16s;
            animation-delay: 3s;
            width: 25px;
            height: 25px;
        }

        .bubble:nth-child(13) {
            left: 40%;
            animation-duration: 23s;
            animation-delay: 6s;
            width: 40px;
            height: 40px;
        }

        .bubble:nth-child(14) {
            left: 55%;
            animation-duration: 19s;
            animation-delay: 2s;
            width: 20px;
            height: 20px;
        }

        .bubble:nth-child(15) {
            left: 70%;
            animation-duration: 26s;
            animation-delay: 4s;
            width: 35px;
            height: 35px;
        }

        .bubble:nth-child(16) {
            left: 85%;
            animation-duration: 18s;
            animation-delay: 7s;
            width: 28px;
            height: 28px;
        }

        .bubble:nth-child(17) {
            left: 95%;
            animation-duration: 24s;
            animation-delay: 5s;
            width: 22px;
            height: 22px;
        }

        .bubble:nth-child(18) {
            left: 8%;
            animation-duration: 20s;
            animation-delay: 9s;
            width: 32px;
            height: 32px;
        }

        .bubble:nth-child(19) {
            left: 30%;
            animation-duration: 22s;
            animation-delay: 8s;
            width: 38px;
            height: 38px;
        }

        .bubble:nth-child(20) {
            left: 50%;
            animation-duration: 25s;
            animation-delay: 10s;
            width: 26px;
            height: 26px;
        }

        .bubble:nth-child(21) {
            left: 60%;
            animation-duration: 20s;
            animation-delay: 0s;
            width: 30px;
            height: 30px;
        }

        .bubble:nth-child(22) {
            left: 75%;
            animation-duration: 15s;
            animation-delay: 2s;
            width: 25px;
            height: 25px;
        }

        .bubble:nth-child(23) {
            left: 30%;
            animation-duration: 22s;
            animation-delay: 5s;
            width: 40px;
            height: 40px;
        }

        .bubble:nth-child(24) {
            left: 10%;
            animation-duration: 18s;
            animation-delay: 1s;
            width: 20px;
            height: 20px;
        }

        .bubble:nth-child(25) {
            left: 45%;
            animation-duration: 25s;
            animation-delay: 3s;
            width: 35px;
            height: 35px;
        }

        .bubble:nth-child(26) {
            left: 82%;
            animation-duration: 17s;
            animation-delay: 6s;
            width: 28px;
            height: 28px;
        }

        .bubble:nth-child(27) {
            left: 92%;
            animation-duration: 23s;
            animation-delay: 4s;
            width: 22px;
            height: 22px;
        }

        .bubble:nth-child(28) {
            left: 12%;
            animation-duration: 19s;
            animation-delay: 8s;
            width: 32px;
            height: 32px;
        }

        .bubble:nth-child(29) {
            left: 55%;
            animation-duration: 22s;
            animation-delay: 8s;
            width: 38px;
            height: 38px;
        }

        .bubble:nth-child(30) {
            left: 25%;
            animation-duration: 21s;
            animation-delay: 7s;
            width: 35px;
            height: 35px;
        }

        /* --- Animaci√≥n Icono --- */
        .icon {
            animation: float 3s ease-in-out infinite alternate;
        }

        @keyframes float {
            0% {
                transform: translateY(-3px);
            }

            100% {
                transform: translateY(3px);
            }
        }

        .icon-tracker {
            width: auto;
            animation: slide 15s linear infinite alternate;
        }

        @keyframes slide {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(calc(100% - 32px));
            }
        }

        /* --- Correcci√≥n de Compatibilidad --- */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
            /* Para Firefox */
            appearance: textfield;
            /* Est√°ndar para otros navegadores */
        }
    </style>
</head>

<body>

    <div id="bubble-container" class="fixed inset-0 w-full h-full overflow-hidden z-20 pointer-events-none">
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
    </div>

    <div id="loginScreen"
        class="flex items-center justify-center min-h-screen relative z-10 transition-all duration-500 ease-out">

        <div class="absolute top-1/4 left-10 text-4xl opacity-50 z-0 transform -rotate-12">üßπ</div>
        <div class="absolute top-1/3 right-12 text-5xl opacity-50 z-0 transform rotate-12">üßº</div>
        <div class="absolute bottom-1/4 left-16 text-3xl opacity-50 z-0 transform rotate-6">ü´ß</div>
        <div class="absolute bottom-1/3 right-10 text-4xl opacity-50 z-0 transform -rotate-6">üßΩ</div>
        <div class="absolute top-1/2 left-20 text-4xl opacity-50 z-0 transform rotate-12">üåä</div>
        <div class="absolute bottom-1/2 right-20 text-5xl opacity-50 z-0 transform -rotate-12">üê¨</div>

        <div class="w-full max-w-md p-8 m-4 bg-white rounded-2xl shadow-xl relative z-10">
            <div class="text-center">
                <svg class="w-20 h-20 mx-auto text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M18 9.8V7a2 2 0 00-2-2h-2a2 2 0 00-2 2v2.8l-5.3 5.3a1 1 0 000 1.4l4.6 4.6a1 1 0 001.4 0L18 9.8zM14 7h2v2h-2V7z M6 15.2V20a1 1 0 001 1h8a1 1 0 001-1v-4.8l-5 5-5-5z M8 3h8v2H8V3z" />
                </svg>
                <h1 class="mt-4 text-4xl font-title text-indigo-700">Productos DelFrio</h1>
                <p class="mt-2 text-lg text-gray-600 font-slogan">La ola de limpieza que tu hogar necesita!</p>
            </div>
            <div class="mt-8">
                <label for="customerName" class="block text-sm font-medium text-gray-700">Tu Nombre:</label>
                <input type="text" id="customerName"
                    class="mt-1 block w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"
                    placeholder="Escribe tu nombre para empezar">
                <p id="nameError" class="mt-2 text-sm text-red-600 hidden">Por favor, escribe tu nombre.</p>
                <button id="loginButton"
                    class="mt-6 w-full bg-gradient-to-r from-indigo-500 to-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:shadow-indigo-500/30 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition-all duration-300 transform hover:scale-105">
                    Ingresar
                </button>
            </div>
        </div>
    </div>

    <div id="appScreen" class="hidden min-h-screen relative z-10 transition-opacity duration-700 ease-in opacity-0">
        <header
            class="sticky top-0 z-30 bg-gradient-to-r from-white via-indigo-50 to-indigo-100 shadow-lg border-b border-gray-200">
            <div class="container mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-2">
                        <span class="font-title text-xl font-bold text-indigo-700">Productos DelFrio</span>
                    </div>

                    <div id="icon-container" class="flex-1 h-8 mx-4 relative overflow-hidden">
                        <div class="icon-tracker absolute top-0 left-0">
                            <svg class="w-8 h-8 text-indigo-500 icon" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M18 9.8V7a2 2 0 00-2-2h-2a2 2 0 00-2 2v2.8l-5.3 5.3a1 1 0 000 1.4l4.6 4.6a1 1 0 001.4 0L18 9.8zM14 7h2v2h-2V7z M6 15.2V20a1 1 0 001 1h8a1 1 0 001-1v-4.8l-5 5-5-5z M8 3h8v2H8V3z" />
                            </svg>
                        </div>
                    </div>

                    <div class="flex items-center space-x-4">
                        <span id="welcomeMessage" class="text-sm text-gray-700 hidden md:block"></span>
                        <button id="cartButton"
                            class="relative bg-gradient-to-r from-indigo-500 to-indigo-700 text-white p-2 rounded-full shadow-lg hover:shadow-indigo-500/30 transition-transform transform hover:scale-110">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                            <span id="cartCount"
                                class="absolute -top-2 -right-2 bg-red-600 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <main class="container mx-auto p-4 pb-40 relative z-10">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 font-slogan">Nuestro Cat√°logo</h2>

            <div class="mb-6 relative">
                <input type="search" id="searchInput" placeholder="Buscar producto (ej. Cloro, Escoba...)"
                    class="w-full px-4 py-3 pl-10 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"
                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                </svg>
            </div>

            <div id="productListContainer" class="space-y-4">
            </div>
        </main>
    </div>

    <div id="cartModal"
        class="fixed inset-0 z-40 flex items-center justify-center hidden bg-black bg-opacity-50 backdrop-blur-sm transition-opacity duration-300 ease-out opacity-0">
        <div
            class="cart-modal-box flex flex-col w-11/12 max-w-lg bg-white/80 backdrop-blur-lg border border-white/20 rounded-2xl shadow-xl h-[90vh] max-h-[600px] overflow-hidden transition-all duration-300 ease-out scale-95">
            <div class="flex items-center justify-between p-5 bg-white/50 border-b border-white/30">
                <h3 class="text-2xl font-bold text-indigo-900 font-slogan">Tu Pedido</h3>
                <button id="closeCartButton"
                    class="text-gray-500 hover:text-gray-800 transition-transform transform hover:rotate-90">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <div id="cartItemsContainer" class="flex-1 p-6 overflow-y-auto space-y-4">
            </div>

            <div class="p-6 bg-white/50 border-t border-white/30">

                <div class="flex justify-between items-center mb-4">
                    <span class="text-lg font-medium text-gray-700">Total:</span>
                    <span id="cartTotal" class="text-2xl font-bold text-indigo-700">$0.00</span>
                </div>
                <button id="checkoutButton"
                    class="w-full bg-gradient-to-r from-indigo-500 to-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:shadow-indigo-500/30 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition-all duration-300 transform hover:scale-105">
                    Realizar Pedido por WhatsApp
                </button>
                <a id="whatsappLinkButton" href="#" target="_blank"
                    class="hidden w-full text-center bg-green-500 text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition-all duration-300 transform hover:scale-105"
                    style="display: none;">
                    Confirmar y Abrir WhatsApp
                </a>
                <button id="cancelCheckoutButton"
                    class="hidden w-full bg-gray-500 text-white font-bold py-2 px-4 rounded-lg mt-2 hover:bg-gray-600 transition-all"
                    style="display: none;">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <div id="orderSuccessModal"
        class="fixed inset-0 z-50 flex items-center justify-center hidden bg-black bg-opacity-60 backdrop-blur-sm transition-opacity duration-300 ease-out opacity-0">
        <div
            class="success-modal-box w-full max-w-md p-8 m-4 text-center bg-white/80 backdrop-blur-lg border border-white/20 rounded-2xl shadow-xl transition-all duration-300 ease-out scale-95">
            <svg class="w-20 h-20 mx-auto text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>
            <h3 id="successTitle" class="mt-4 text-2xl font-bold text-gray-900">¬°Gracias por tu pedido!</h3>
            <p id="successMessage" class="mt-2 text-gray-600">Se est√° abriendo WhatsApp. Una vez enviado el mensaje,
                nosotros nos encargaremos del resto.</p>
            <button id="closeSuccessButton"
                class="mt-6 w-full bg-gradient-to-r from-indigo-500 to-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:shadow-indigo-500/30 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition-all">
                Entendido
            </button>
        </div>
    </div>

    <div id="toast"
        class="fixed bottom-5 right-5 z-[100] px-5 py-3 text-white bg-gray-900 rounded-lg shadow-lg transition-transform translate-x-[150%] duration-300 ease-in-out">
        <p id="toastMessage">¬°Producto agregado!</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Base de Datos ---
            const productData = {
                "Blanqueadores": [
                    { id: 1001, name: "Cloro", price: 5.00 },
                    { id: 1002, name: "Cloro en Gel", price: 20.00 },
                    { id: 1003, name: "Vanish", price: 20.00 }
                ],
                "Jab√≥nes para ropa": [
                    { id: 2001, name: "Ariel con Downy", price: 20.00 },
                    { id: 2002, name: "Ariel Oxxy", price: 20.00 },
                    { id: 2003, name: "Ariel Doble Poder", price: 20.00 },
                    { id: 2004, name: "M√°s Negrura", price: 20.00 },
                    { id: 2005, name: "Zote rosa/blanco", price: 20.00 },
                    { id: 2006, name: "M√°s Color", price: 20.00 },
                    { id: 2007, name: "Vel Rosita", price: 20.00 }
                ],
                "Fabulosos": [
                    { id: 3001, name: "Lavanda", price: 10.00 },
                    { id: 3002, name: "Mar Fresco", price: 10.00 },
                    { id: 3003, name: "Frutos Rojos", price: 10.00 },
                    { id: 3004, name: "C√≠tricos", price: 10.00 },
                    { id: 3005, name: "Lima Lim√≥n", price: 10.00 },
                    { id: 3006, name: "Violetas", price: 10.00 },
                    { id: 3007, name: "Manzana-Canela", price: 10.00 },
                    { id: 3008, name: "Stefano", price: 10.00 },
                    { id: 3009, name: "Hugo Boss", price: 10.00 },
                    { id: 3010, name: "Mango-Kiwi", price: 10.00 },
                    { id: 3011, name: "Sand√≠a", price: 10.00 },
                    { id: 3012, name: "Brisas", price: 10.00 }
                ],
                "Pino": [
                    { id: 4001, name: "Pino Blanco", price: 8.00 }
                ],
                "Suavizante de telas": [
                    { id: 5001, name: "Suavitel Beb√©", price: 15.00 },
                    { id: 5002, name: "Suavitel Primavera", price: 15.00 },
                    { id: 5003, name: "Suavitel Perlas Activas", price: 15.00 },
                    { id: 5004, name: "Downy", price: 15.00 },
                    { id: 5005, name: "Suavitel Anochecer", price: 15.00 },
                    { id: 5006, name: "Suavitel Dulce Placer", price: 15.00 },
                    { id: 5007, name: "Suavitel Queen", price: 15.00 },
                    { id: 5008, name: "Suavitel Sensacional", price: 15.00 },
                    { id: 5009, name: "Suavitel Naturaleza", price: 15.00 },
                    { id: 5010, name: "Suavitel Ensue√±o", price: 15.00 }
                ],
                "Jab√≥n para trastes": [
                    { id: 6001, name: "Salvo", price: 25.00 }
                ],
                "Aromatizantes": [
                    { id: 7001, name: "Perry Ellies", price: 15.00 },
                    { id: 7002, name: "Stefano", price: 15.00 },
                    { id: 7003, name: "360¬∞", price: 15.00 },
                    { id: 7004, name: "Chica Fresa", price: 15.00 },
                    { id: 7005, name: "Chicle", price: 15.00 },
                    { id: 7006, name: "Canela", price: 15.00 },
                    { id: 7007, name: "Manza", price: 15.00 },
                    { id: 7008, name: "Ferrary", price: 15.00 },
                    { id: 7009, name: "Polo Sport", price: 15.00 },
                    { id: 7010, name: "Carolina Herrera", price: 15.00 },
                    { id: 7011, name: "Coco", price: 15.00 },
                    { id: 7012, name: "Drakar", price: 15.00 },
                    { id: 7013, name: "Black Ice", price: 15.00 },
                    { id: 7014, name: "Animal", price: 15.00 }
                ],
                "Linea Automotriz": [
                    { id: 8001, name: "Armor All L√≠quido", price: 40.00 },
                    { id: 8002, name: "Glicerina", price: 80.00 },
                    { id: 8003, name: "Detercon", price: 20.00 },
                    { id: 8004, name: "Esponja Suave", price: 12.00 },
                    { id: 8005, name: "Esponja Dura", price: 18.00 },
                    { id: 8006, name: "Teflon Automotriz", price: 25.00 },
                    { id: 8007, name: "Armor All en Gel", price: 45.00 },
                    { id: 8008, name: "Desengrasante Industrial", price: 25.00 }
                ],
                "Otros Productos": [
                    { id: 9001, name: "Jab√≥n en Polvo (kg)", price: 28.00 },
                    { id: 9002, name: "Mata-todo", price: 25.00 },
                    { id: 9003, name: "Criolina", price: 30.00 },
                    { id: 9004, name: "Sosa Liquida", price: 25.00 },
                    { id: 9005, name: "Quitasarro", price: 30.00 }
                ],
                "Jab√≥n para Manos": [
                    { id: 10001, name: "Cereza", price: 15.00 },
                    { id: 10002, name: "Pera-Manzana", price: 15.00 },
                    { id: 10003, name: "Sand√≠a", price: 15.00 },
                    { id: 10004, name: "Pl√°tano", price: 15.00 },
                    { id: 10005, name: "Coco", price: 15.00 }
                ],
                "Jarcer√≠a": [
                    { id: 11001, name: "Lazo para Tendedero 10 mts", price: 30.00 },
                    { id: 11002, name: "Lazo para Tendedero 15 mts", price: 40.00 },
                    { id: 11003, name: "J√≠caras", price: 5.00 },
                    { id: 11004, name: "Pinzas 50 pzs.", price: 35.00 },
                    { id: 11005, name: "Atomizador 1 lt", price: 35.00 },
                    { id: 11006, name: "Atomizador 1/2 lt", price: 25.00 },
                    { id: 11007, name: "Cepillo para Ropa Chico", price: 10.00 },
                    { id: 11008, name: "Cepillo para Ropa Grande Flexible", price: 20.00 },
                    { id: 11009, name: "Cepillo para Ropa Mediano Duro", price: 20.00 },
                    { id: 11010, name: "Cepillo para Ropa Grande", price: 18.00 },
                    { id: 11011, name: "Pastilla para Ba√±o", price: 15.00 },
                    { id: 11012, name: "Pastillas de Cloro (4 pzs.)", price: 20.00 },
                    { id: 11013, name: "Piedra P√≥mez", price: 7.00 },
                    { id: 11014, name: "Fibra Aj√°x", price: 5.00 },
                    { id: 11015, name: "Fibra Mex Verde Chica", price: 8.00 },
                    { id: 11016, name: "Fibra Mex Verde Grande", price: 12.00 },
                    { id: 11017, name: "Fibra de Scotch Brite", price: 25.00 },
                    { id: 11018, name: "Fibra de Metal Redonda Grande", price: 15.00 },
                    { id: 11019, name: "Fibra de Metal Redonda Chica", price: 10.00 },
                    { id: 11020, name: "Fibra Mini Acero", price: 8.00 },
                    { id: 11021, name: "Fibra Esponja Multiusos", price: 12.00 },
                    { id: 11022, name: "Sacate para Trastes", price: 12.00 },
                    { id: 11023, name: "Freg√≥n", price: 15.00 },
                    { id: 11024, name: "Escobetas", price: 10.00 },
                    { id: 11025, name: "Escobeta Pl√°stico", price: 15.00 },
                    { id: 11026, name: "Tierra Azul Bolsa", price: 4.00 },
                    { id: 11027, name: "Tierra Rosa Bolsa", price: 4.00 },
                    { id: 11028, name: "Escoba Mega Econ√≥mica", price: 40.00 },
                    { id: 11029, name: "Escoba Palma de Oro", price: 70.00 },
                    { id: 11030, name: "Escoba Perico", price: 70.00 },
                    { id: 11031, name: "Palo de Escoba", price: 20.00 },
                    { id: 11032, name: "Jalador Jumbo", price: 60.00 },
                    { id: 11033, name: "Mechudo", price: 70.00 },
                    { id: 11034, name: "Recogedor de Metal", price: 40.00 },
                    { id: 11035, name: "Recogedor Grande de Pl√°stico", price: 40.00 },
                    { id: 11036, name: "Jergas 1 mt.", price: 25.00 },
                    { id: 11037, name: "Bote de Basura", price: 30.00 },
                    { id: 11038, name: "Trapo de Cocina", price: 10.00 },
                    { id: 11039, name: "Franela", price: 20.00 },
                    { id: 11040, name: "Franela Estampada", price: 35.00 },
                    { id: 11041, name: "Guantes", price: 25.00 },
                    { id: 11042, name: "Cubeta Grande de Pl√°stico", price: 35.00 },
                    { id: 11043, name: "Cubeta Chica de Pl√°stico", price: 25.00 },
                    { id: 11044, name: "Ganchos", price: 35.00 },
                    { id: 11045, name: "Tierra Eficaz (bolsa)", price: 10.00 },
                    { id: 11046, name: "Sacate para Ba√±o", price: 15.00 },
                    { id: 11047, name: "Carrusel Redondo", price: 60.00 }
                ]
            };

            // --- Estado de la Aplicaci√≥n ---
            let cart = {};
            let customerName = "";
            const businessPhoneNumber = "5215636222837";

            // --- Selectores del DOM ---
            const loginScreen = document.getElementById('loginScreen');
            const appScreen = document.getElementById('appScreen');
            const customerNameInput = document.getElementById('customerName');
            const loginButton = document.getElementById('loginButton');
            const nameError = document.getElementById('nameError');

            const welcomeMessage = document.getElementById('welcomeMessage');
            const cartButton = document.getElementById('cartButton');
            const cartCount = document.getElementById('cartCount');
            const productListContainer = document.getElementById('productListContainer');

            const searchInput = document.getElementById('searchInput');

            const cartModal = document.getElementById('cartModal');
            const closeCartButton = document.getElementById('closeCartButton');
            const cartItemsContainer = document.getElementById('cartItemsContainer');
            const cartTotal = document.getElementById('cartTotal');
            const checkoutButton = document.getElementById('checkoutButton');
            const whatsappLinkButton = document.getElementById('whatsappLinkButton');
            const cancelCheckoutButton = document.getElementById('cancelCheckoutButton');

            const orderSuccessModal = document.getElementById('orderSuccessModal');
            const closeSuccessButton = document.getElementById('closeSuccessButton');
            const successTitle = document.getElementById('successTitle');
            const successMessage = document.getElementById('successMessage');

            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');

            const iconContainer = document.getElementById('icon-container');

            // --- Funciones de L√≥gica ---

            function positionIconContainer() {
                const header = appScreen.querySelector('header .container');
                const title = header.querySelector('.font-title');
                const cartSection = header.querySelector('.flex.items-center.space-x-4');

                if (header && title && cartSection && iconContainer) {
                    const headerWidth = header.offsetWidth;
                    const titleWidth = title.offsetWidth;
                    const cartWidth = cartSection.offsetWidth;
                    const availableSpace = headerWidth - titleWidth - cartWidth - 40;

                    if (availableSpace > 50) {
                        iconContainer.style.width = `${availableSpace}px`;
                        iconContainer.classList.remove('hidden');
                    } else {
                        iconContainer.classList.add('hidden');
                    }
                }
            }

            function renderProducts(dataToRender = productData) {
                productListContainer.innerHTML = '';
                let isFirstCategory = true;

                const fullCategoryCount = Object.keys(productData).length;
                const renderedCategoryCount = Object.keys(dataToRender).length;
                const isSearching = fullCategoryCount !== renderedCategoryCount || searchInput.value.length > 0;

                for (const category in dataToRender) {
                    const categoryId = category.replace(/\s+/g, '-').toLowerCase();

                    const isOpen = (isFirstCategory && !isSearching) || isSearching ? 'open' : '';

                    const accordionItem = document.createElement('div');
                    accordionItem.className = 'bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden';

                    const header = document.createElement('div');
                    header.className = `accordion-header flex justify-between items-center p-5 ${isOpen}`;
                    header.setAttribute('data-target', `#content-${categoryId}`);
                    header.innerHTML = `
                    <h3 class="text-xl font-bold text-indigo-700 font-slogan">${category}</h3>
                    <svg class="accordion-arrow w-6 h-6 text-indigo-500 transition-transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                    </svg>
                `;

                    const content = document.createElement('div');
                    content.id = `content-${categoryId}`;
                    content.className = `accordion-content ${isOpen}`;

                    const grid = document.createElement('div');
                    grid.className = 'grid grid-cols-1 md:grid-cols-2 gap-4';

                    dataToRender[category].forEach(product => {
                        const productCard = createProductCard(product);
                        grid.appendChild(productCard);
                    });

                    content.appendChild(grid);
                    accordionItem.appendChild(header);
                    accordionItem.appendChild(content);
                    productListContainer.appendChild(accordionItem);

                    isFirstCategory = false;
                }
            }

            // --- FUNCI√ìN createProductCard MODIFICADA ---
            function createProductCard(product) {
                const card = document.createElement('div');
                card.className = 'flex flex-col p-4 bg-gray-50 rounded-lg border border-gray-200';

                const currentQuantity = cart[product.id] ? cart[product.id].quantity : 0;
                const currentAmount = currentQuantity * product.price;

                card.innerHTML = `
                <div>
                    <p class="font-bold text-gray-800">${product.name}</p>
                    <p class="text-sm text-gray-600">$${product.price.toFixed(2)} / L/Kg</p>
                </div>
                <div class="mt-4" data-product-id="${product.id}">
                    
                    <label for="money-${product.id}" class="text-sm font-medium text-gray-600 mb-1 block">Monto ($):</label>
                    <div class="flex items-center mb-3">
                        <span class="flex items-center justify-center h-10 w-10 bg-gray-200 text-gray-700 rounded-l-lg">$</span>
                        <input 
                            type="number" 
                            id="money-${product.id}" 
                            data-id="${product.id}"
                            data-price="${product.price}"
                            value="${currentAmount > 0 ? currentAmount.toFixed(2) : ''}"
                            min="0" 
                            step="0.01" 
                            placeholder="0.00"
                            class="product-money-input w-full h-10 px-2 py-2 border-t border-b border-r border-gray-300 rounded-r-lg text-center focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>

                    <label for="qty-${product.id}" class="text-sm font-medium text-gray-600 mb-1 block">Cantidad (L/Kg):</label>
                    <div class="flex items-center">
                        <button data-id="${product.id}" data-action="decrease" class="quantity-btn flex items-center justify-center h-10 w-10 bg-gray-200 text-gray-700 rounded-l-lg hover:bg-gray-300 active:scale-90 transition">&minus;</button>
                        <input 
                            type="number" 
                            id="qty-${product.id}" 
                            data-id="${product.id}"
                            data-price="${product.price}"
                            value="${currentQuantity > 0 ? currentQuantity : ''}"
                            min="0" 
                            step="0.001" 
                            placeholder="0.000"
                            class="product-quantity-input w-20 h-10 px-2 py-2 border-t border-b border-gray-300 text-center focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <button data-id="${product.id}" data-action="increase" class="quantity-btn flex items-center justify-center h-10 w-10 bg-gray-200 text-gray-700 rounded-r-lg hover:bg-gray-300 active:scale-90 transition">&plus;</button>
                    </div>
                    
                    <div class="flex items-center space-x-2 mt-2">
                        <button data-id="${product.id}" data-action="add-fraction" data-amount="0.25" class="fraction-btn flex-1 py-1 px-2 bg-indigo-100 text-indigo-700 rounded-md text-sm hover:bg-indigo-200 active:scale-90 transition">+&frac14; (0.25)</button>
                        <button data-id="${product.id}" data-action="add-fraction" data-amount="0.5" class="fraction-btn flex-1 py-1 px-2 bg-indigo-100 text-indigo-700 rounded-md text-sm hover:bg-indigo-200 active:scale-90 transition">+&frac12; (0.5)</button>
                        <button data-id="${product.id}" data-action="add-fraction" data-amount="1" class="fraction-btn flex-1 py-1 px-2 bg-indigo-100 text-indigo-700 rounded-md text-sm hover:bg-indigo-200 active:scale-90 transition">+1</button>
                    </div>
                </div>
            `;
                return card;
            }

            // --- FUNCI√ìN renderCart MODIFICADA ---
            function renderCart() {
                cartItemsContainer.innerHTML = '';
                let total = 0;
                const cartHasItems = Object.keys(cart).length > 0;

                if (cartHasItems) {
                    for (const productId in cart) {
                        const item = cart[productId];
                        const itemTotal = item.price * item.quantity;
                        total += itemTotal;

                        const cartItemElement = document.createElement('div');
                        cartItemElement.className = 'flex items-center justify-between p-4 bg-white/70 rounded-lg shadow-sm border border-gray-200';

                        // Se usa toFixed(3) para mostrar cantidades como 0.600
                        const formattedQuantity = parseFloat(item.quantity.toFixed(3));

                        cartItemElement.innerHTML = `
                        <div class="flex-1 pr-4">
                            <h5 class="font-bold text-gray-800">${item.name}</h5>
                            <p class="text-sm text-gray-600">$${item.price.toFixed(2)} c/u</p>
                            <p class="text-xs text-gray-500">(${formattedQuantity} L/Kg)</p> 
                            <p class="text-lg font-bold text-indigo-700 mt-1">$${itemTotal.toFixed(2)}</p>
                        </div>
                        <div class="flex items-center">
                            <button data-id="${productId}" data-action="decrease-cart" class="cart-quantity-btn flex items-center justify-center h-8 w-8 bg-gray-200 text-gray-700 rounded-l-lg hover:bg-gray-300 active:scale-90 transition">&minus;</button>
                            <input 
                                type="number" 
                                data-id="${productId}"
                                data-price="${item.price}" 
                                value="${formattedQuantity}"
                                min="0" 
                                step="0.001" 
                                class="cart-quantity-input w-20 h-8 px-2 border-t border-b border-gray-300 text-center focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                >
                            <button data-id="${productId}" data-action="increase-cart" class="cart-quantity-btn flex items-center justify-center h-8 w-8 bg-gray-200 text-gray-700 rounded-r-lg hover:bg-gray-300 active:scale-90 transition">&plus;</button>
                        </div>
                    `;
                        cartItemsContainer.appendChild(cartItemElement);
                    }
                } else {
                    cartItemsContainer.innerHTML = '<p class="text-gray-500 text-center">A√∫n no has agregado productos.</p>';
                }

                const paymentInfoHTML = `
                <div class="mt-6 pt-4 border-t border-indigo-200/50">
                    <div class="p-4 bg-indigo-50/70 border border-indigo-200/60 rounded-lg">
                        <h4 class="text-sm font-bold text-indigo-800 mb-2">Formas de pago aceptadas:‚úÖ</h4>
                        <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                            <li><span class="font-semibold">Efectivo üíµü™ô(al momento de la entrega de su pedido)</span></li>
                            <li>
                                <span class="font-semibold">Transferencia Bancaria: üì≤üí∏</span>
                                <ul class="list-none pl-6 text-xs text-gray-600">
                                    <li><strong>Banco:</strong> BBVA</li>
                                    <li><strong>Nombre:</strong> LUIS ADRIAN RAYON UGALDE</li>
                                    <li><strong>CLABE:</strong> 012 180 01537760792 9</li>
                                    <li><strong>Numero de Tarjeta:</strong> 4152 3144 7764 4093</li>
                                    <li><strong>Concepto:</strong> TU NOMBRE DE CLIENTE</li>
                                </ul>
                            </li>
                        </ul>
                        <p class="text-xs text-indigo-700 mt-2 italic">Por favor, env√≠a tu comprobante por WhatsApp al confirmar.</p>
                    </div>
                </div>
            `;
                cartItemsContainer.insertAdjacentHTML('beforeend', paymentInfoHTML);

                cartTotal.textContent = `$${total.toFixed(2)}`;
                if (cartHasItems) {
                    checkoutButton.disabled = false;
                    checkoutButton.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    checkoutButton.disabled = true;
                    checkoutButton.classList.add('opacity-50', 'cursor-not-allowed');
                }
            }

            // --- FUNCI√ìN setCartQuantity MODIFICADA ---
            function setCartQuantity(productId, quantity, isFractionAdd = false, isIncrement = false, isDecrement = false) {
                const product = findProductById(productId, true);
                if (!product) return;

                let currentQuantity = cart[productId] ? cart[productId].quantity : 0;
                let newQuantity;

                if (isFractionAdd) {
                    newQuantity = currentQuantity + quantity;
                } else if (isIncrement) {
                    newQuantity = currentQuantity + 1;
                } else if (isDecrement) {
                    newQuantity = currentQuantity - 1;
                } else {
                    newQuantity = quantity;
                }

                newQuantity = Math.max(0, newQuantity);
                // Redondear a 3 decimales para precisi√≥n (ej. 0.600 L)
                newQuantity = Math.round(newQuantity * 1000) / 1000;

                if (newQuantity > currentQuantity) {
                    showToast(`"${product.name}" agregado`);
                }

                if (newQuantity > 0) {
                    cart[productId] = {
                        name: product.name,
                        price: product.price,
                        quantity: newQuantity
                    };
                } else {
                    delete cart[productId];
                }

                updateCartUI();

                // --- SINCRONIZACI√ìN DE INPUTS ---
                // Sincronizar el input de CANTIDAD del cat√°logo
                const mainQuantityInput = document.getElementById(`qty-${productId}`);
                if (mainQuantityInput && document.activeElement !== mainQuantityInput) {
                    mainQuantityInput.value = newQuantity > 0 ? newQuantity.toFixed(3).replace(/\.?0+$/, '') : ''; // Muestra 0.6, no 0.600
                }

                // Sincronizar el input de DINERO del cat√°logo
                const mainMoneyInput = document.getElementById(`money-${productId}`);
                if (mainMoneyInput && document.activeElement !== mainMoneyInput) {
                    const amount = newQuantity * product.price;
                    mainMoneyInput.value = amount > 0 ? amount.toFixed(2) : '';
                }

                if (!cartModal.classList.contains('hidden')) {
                    renderCart();
                }
            }

            function updateCartUI() {
                let totalItems = 0;
                for (const productId in cart) {
                    totalItems += cart[productId].quantity;
                }
                // Muestra decimales solo si son necesarios
                cartCount.textContent = parseFloat(totalItems.toFixed(3));
            }

            function showToast(message) {
                toastMessage.textContent = message;
                toast.classList.remove('translate-x-[150%]');
                toast.classList.add('translate-x-0');

                setTimeout(() => {
                    toast.classList.remove('translate-x-0');
                    toast.classList.add('translate-x-[150%]');
                }, 3000);
            }

            // --- FUNCI√ìN generateWhatsAppLink MODIFICADA ---
            function generateWhatsAppLink() {
                let message = `¬°Hola *Productos DelFrio*!\n\nSoy *${customerName}* y me gustar√≠a hacer el siguiente pedido:\n\n`;
                let total = 0;

                for (const productId in cart) {
                    const item = cart[productId];
                    const itemTotal = item.price * item.quantity;
                    // Formatear cantidad a 3 decimales
                    const formattedQuantity = parseFloat(item.quantity.toFixed(3));
                    message += `*${formattedQuantity} L/Kg* x ${item.name} - $${itemTotal.toFixed(2)}\n`;
                    total += itemTotal;
                }
                message += `\n*TOTAL: $${total.toFixed(2)}*\n\n¬°Muchas gracias!`;

                const encodedMessage = encodeURIComponent(message);
                return `https://api.whatsapp.com/send?phone=${businessPhoneNumber}&text=${encodedMessage}`;
            }

            function findProductById(productId, returnObject = false) {
                productId = parseInt(productId, 10);
                for (const category in productData) {
                    const product = productData[category].find(p => p.id === productId);
                    if (product) {
                        return returnObject ? product : product.name;
                    }
                }
                return returnObject ? null : "Producto";
            }

            // --- Event Listeners ---

            loginButton.addEventListener('click', () => {
                customerName = customerNameInput.value.trim();
                if (customerName) {
                    loginScreen.classList.add('opacity-0', 'scale-150');
                    appScreen.classList.remove('hidden');

                    const firstName = customerName.split(' ')[0];
                    welcomeMessage.textContent = `¬°Hola, ${firstName}!`;
                    renderProducts();

                    setTimeout(() => {
                        appScreen.classList.remove('opacity-0');
                        positionIconContainer();
                    }, 300);

                    setTimeout(() => {
                        loginScreen.classList.add('hidden');
                    }, 700);

                } else {
                    nameError.classList.remove('hidden');
                    customerNameInput.classList.add('border-red-500');
                }
            });

            customerNameInput.addEventListener('input', () => {
                if (customerNameInput.value.trim()) {
                    nameError.classList.add('hidden');
                    customerNameInput.classList.remove('border-red-500');
                }
            });

            window.addEventListener('resize', positionIconContainer);

            // --- LISTENER B√öSQUEDA ---
            searchInput.addEventListener('input', () => {
                const searchTerm = searchInput.value.toLowerCase().trim();

                if (searchTerm === '') {
                    renderProducts(productData);
                    return;
                }

                const filteredData = {};

                for (const category in productData) {
                    const matchingProducts = productData[category].filter(p =>
                        p.name.toLowerCase().includes(searchTerm)
                    );

                    if (matchingProducts.length > 0) {
                        filteredData[category] = matchingProducts;
                    }
                }
                renderProducts(filteredData);
            });

            cartButton.addEventListener('click', () => {
                const modalBox = cartModal.querySelector('.cart-modal-box');
                cartModal.classList.remove('hidden');
                cartModal.offsetWidth;
                cartModal.classList.remove('opacity-0');
                modalBox.classList.remove('scale-95');

                renderCart();

                checkoutButton.classList.remove('hidden');
                whatsappLinkButton.classList.add('hidden');
                whatsappLinkButton.style.display = 'none';
                cancelCheckoutButton.classList.add('hidden');
                cancelCheckoutButton.style.display = 'none';
            });

            closeCartButton.addEventListener('click', () => {
                const modalBox = cartModal.querySelector('.cart-modal-box');
                cartModal.classList.add('opacity-0');
                modalBox.classList.add('scale-95');

                setTimeout(() => {
                    cartModal.classList.add('hidden');
                }, 300);
            });

            // --- LISTENER CAT√ÅLOGO (Click) ---
            productListContainer.addEventListener('click', (e) => {
                const target = e.target;

                const quantityBtn = target.closest('.quantity-btn');
                if (quantityBtn) {
                    e.preventDefault();
                    const productId = quantityBtn.dataset.id;
                    const action = quantityBtn.dataset.action;

                    if (action === 'increase') {
                        setCartQuantity(productId, 1, false, true, false);
                    } else if (action === 'decrease') {
                        setCartQuantity(productId, 1, false, false, true);
                    }
                    return;
                }

                const fractionBtn = target.closest('.fraction-btn');
                if (fractionBtn) {
                    e.preventDefault();
                    const productId = fractionBtn.dataset.id;
                    const amount = parseFloat(fractionBtn.dataset.amount);
                    setCartQuantity(productId, amount, true, false, false);
                    return;
                }

                const header = e.target.closest('.accordion-header');
                if (header) {
                    const targetId = header.dataset.target;
                    const content = document.querySelector(targetId);

                    if (content.classList.contains('open')) {
                        content.classList.remove('open');
                        header.classList.remove('open');
                    } else {
                        document.querySelectorAll('.accordion-content.open').forEach(openContent => {
                            openContent.classList.remove('open');
                            openContent.previousElementSibling.classList.remove('open');
                        });

                        content.classList.add('open');
                        header.classList.add('open');
                    }
                }
            });

            // --- LISTENER CAT√ÅLOGO (Input) ---
            productListContainer.addEventListener('input', (e) => {
                const target = e.target;
                const productId = target.dataset.id;
                if (!productId) return;

                const price = parseFloat(target.dataset.price);
                if (isNaN(price) || price === 0) return;

                const card = target.closest('[data-product-id]');
                const moneyInput = card.querySelector(`.product-money-input[data-id="${productId}"]`);
                const quantityInput = card.querySelector(`.product-quantity-input[data-id="${productId}"]`);

                let quantity = 0;
                let amount = 0;

                if (target.classList.contains('product-quantity-input')) {
                    // --- El usuario cambi√≥ la CANTIDAD ---
                    quantity = parseFloat(target.value) || 0;
                    amount = quantity * price;

                    if (document.activeElement === target) { // Solo actualiza si no est√° activo
                        moneyInput.value = amount > 0 ? amount.toFixed(2) : '';
                    }

                } else if (target.classList.contains('product-money-input')) {
                    // --- El usuario cambi√≥ el DINERO ---
                    amount = parseFloat(target.value) || 0;
                    quantity = amount / price;

                    if (document.activeElement === target) {
                        quantityInput.value = quantity > 0 ? quantity.toFixed(3) : '';
                    }
                }

                const finalQuantity = parseFloat(quantity.toFixed(3));

                setCartQuantity(productId, finalQuantity, false, false, false);
            });

            // --- LISTENER CARRITO (Click) ---
            cartItemsContainer.addEventListener('click', (e) => {
                const target = e.target;
                const quantityBtn = target.closest('.cart-quantity-btn');

                if (quantityBtn) {
                    e.preventDefault();
                    const productId = quantityBtn.dataset.id;
                    const action = quantityBtn.dataset.action;

                    if (action === 'increase-cart') {
                        setCartQuantity(productId, 1, false, true, false);
                    } else if (action === 'decrease-cart') {
                        setCartQuantity(productId, 1, false, false, true);
                    }
                }
            });

            // --- LISTENER CARRITO (Input) ---
            cartItemsContainer.addEventListener('input', (e) => {
                const target = e.target;
                if (target.classList.contains('cart-quantity-input')) {
                    const productId = target.dataset.id;
                    let quantity = parseFloat(target.value);

                    if (isNaN(quantity) || quantity < 0) {
                        quantity = 0;
                    }

                    setCartQuantity(productId, quantity, false, false, false);
                }
            });

            // --- Listeners de Checkout ---
            checkoutButton.addEventListener('click', () => {
                const link = generateWhatsAppLink();
                whatsappLinkButton.href = link;

                checkoutButton.classList.add('hidden');
                whatsappLinkButton.classList.remove('hidden');
                whatsappLinkButton.style.display = 'block';
                cancelCheckoutButton.classList.remove('hidden');
                cancelCheckoutButton.style.display = 'block';
            });

            cancelCheckoutButton.addEventListener('click', () => {
                checkoutButton.classList.remove('hidden');
                whatsappLinkButton.classList.add('hidden');
                whatsappLinkButton.style.display = 'none';
                cancelCheckoutButton.classList.add('hidden');
                cancelCheckoutButton.style.display = 'none';
            });

            whatsappLinkButton.addEventListener('click', () => {
                const successBox = orderSuccessModal.querySelector('.success-modal-box');
                orderSuccessModal.classList.remove('hidden');
                orderSuccessModal.offsetWidth;
                orderSuccessModal.classList.remove('opacity-0');
                successBox.classList.remove('scale-95');

                const cartModalBox = cartModal.querySelector('.cart-modal-box');
                cartModal.classList.add('opacity-0');
                cartModalBox.classList.add('scale-95');
                setTimeout(() => {
                    cartModal.classList.add('hidden');
                }, 300);

                setTimeout(() => {
                    cart = {};
                    updateCartUI();
                    renderProducts();
                    searchInput.value = ''; // Limpiar b√∫squeda
                }, 500);
            });

            closeSuccessButton.addEventListener('click', () => {
                const successBox = orderSuccessModal.querySelector('.success-modal-box');
                orderSuccessModal.classList.add('opacity-0');
                successBox.classList.add('scale-95');

                setTimeout(() => {
                    orderSuccessModal.classList.add('hidden');
                }, 300);
            });

        });
    </script>

</body>

</html>

